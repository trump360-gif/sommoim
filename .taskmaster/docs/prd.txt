# 소모임 플랫폼 (Sommoim) - PRD

## 프로젝트 개요
관심사 기반 소모임 생성/참가 플랫폼. 사용자들이 모임을 만들고, 검색하고, 참가할 수 있는 웹 서비스.

## 기술 스택
- Frontend: Next.js 14 (App Router), TypeScript, React Query, Zustand, Tailwind CSS
- Backend: NestJS 10, TypeScript, Prisma, PostgreSQL 15, Redis 7, Bull Queue, Socket.IO
- Infra: Podman, Cloudflare R2, Fly.io

## 핵심 기능

### Phase 1: 기초 구축 (1.5주)
1. NestJS 프로젝트 초기화 및 구조 설정
2. Prisma 스키마 작성 (User, Profile, Meeting, MeetingSchedule, Participant 등)
3. PostgreSQL + Redis Podman 컨테이너 설정
4. Auth 모듈 구현 (회원가입, 로그인, JWT, httpOnly 쿠키)
5. 환경 변수 관리 및 검증
6. 500자 규칙 자동 검사 스크립트 설정

### Phase 2: 코어 기능 (2.5주)
7. 사용자 프로필 CRUD (닉네임, 자기소개, 프로필 사진)
8. 모임 CRUD API (생성, 조회, 수정, 삭제)
9. 모임 검색 및 필터링 (카테고리, 지역, 날짜, 상태)
10. 참가 신청/승인/거절/강퇴 시스템
11. Cloudflare R2 연동 (Presigned URL 방식)
12. 파일 업로드 검증 (이미지만, 5MB 제한)

### Phase 3: 확장 기능 (3주)
13. 모임 일정 CRUD (다중 일정 지원)
14. 모임 상태 자동화 스케줄러 (RECRUITING → ONGOING → COMPLETED)
15. Bull Queue 기반 알림 시스템
16. 알림 API (목록, 읽음 처리)
17. 리뷰/평점 시스템
18. 신고 시스템 (모임, 사용자)
19. 사용자 차단 기능
20. 활동 로그 (변경 이력 추적)

### Phase 4: 관리자 (2주)
21. 관리자 인증 및 권한 체크 (RBAC)
22. 섹션 CRUD (Hero, Featured, Categories 등)
23. 배너 CRUD
24. 카테고리 CRUD
25. 드래그 앤 드롭 정렬 API
26. 대시보드 통계 API
27. 신고 처리 워크플로우
28. 점검 모드 설정

### Phase 5: 실시간 통신 (1.5주)
29. Socket.IO 게이트웨이 설정
30. WebSocket JWT 인증
31. 모임별 채팅방 (네임스페이스)
32. 채팅 메시지 저장/조회/삭제
33. 실시간 알림 전송

### Phase 6: 프론트엔드 (3주)
34. Next.js 14 App Router 설정
35. 인증 페이지 (로그인, 회원가입, 비밀번호 찾기)
36. 홈페이지 (섹션, 배너, 추천 모임)
37. 모임 목록 페이지 (필터, 검색, 페이지네이션)
38. 모임 상세 페이지 (정보, 일정, 참가자, 리뷰)
39. 모임 생성/수정 폼
40. 채팅 페이지 (Socket.IO 연동)
41. 프로필 페이지
42. 알림 페이지
43. 관리자 대시보드

### Phase 7: 폴리싱 및 배포 (2주)
44. 성능 최적화 (캐싱, 인덱싱, 쿼리 최적화)
45. 단위 테스트 작성 (커버리지 70%+)
46. 통합 테스트 작성
47. E2E 테스트 (핵심 시나리오)
48. 보안 감사 (OWASP Top 10)
49. Fly.io 배포 설정
50. CI/CD 파이프라인 (GitHub Actions)
51. Sentry 모니터링 설정
52. 문서화 완료

## 보안 요구사항
- JWT + httpOnly 쿠키 (XSS/CSRF 방어)
- 비밀번호 bcrypt 해싱 (cost 12+)
- Rate Limiting (로그인 5회/분, API 100회/분)
- 입력 검증 (class-validator)
- XSS 방어 (DOMPurify)
- SQL Injection 방어 (Prisma ORM)
- HTTPS 강제
- 보안 헤더 (helmet)

## API 응답 형식
성공: { success: true, data: {...}, meta?: {...} }
에러: { success: false, error: { statusCode, message, timestamp, path } }

## 데이터베이스 주요 테이블
- User, Profile, Follow
- Meeting, MeetingSchedule
- Participant
- Review
- Report, UserBlock
- Notification
- ChatMessage
- PageSection, Banner, CategoryEntity
- RefreshToken, TokenBlacklist
- ActivityLog

## 관리자 섹션 layout_json 구조
```json
{
  "type": "hero|featured|categories|banner|meetings",
  "config": {
    "columns": 3,
    "showTitle": true,
    "limit": 6
  }
}
```

## Presigned URL 업로드 방식
1. 클라이언트가 /api/upload/presigned-url 요청
2. 서버가 R2 Presigned URL 발급
3. 클라이언트가 R2에 직접 업로드
4. 클라이언트가 업로드된 URL을 서버에 전송
